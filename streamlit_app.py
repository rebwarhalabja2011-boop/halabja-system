import streamlit as st
from streamlit_gsheets import GSheetsConnection
import pandas as pd

# --- Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ù„Ø§Ù¾Û•Ú•Û• ---
st.set_page_config(page_title="Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ø´Û•Ù‡ÛŒØ¯Ø§Ù†ÛŒ Ù‡Û•ÚµÛ•Ø¨Ø¬Û•", layout="wide")

# Ù„ÛØ±Û• Ø¦Û•Ùˆ Ù„ÛŒÙ†Ú©Û•ÛŒ Ú©Û†Ù¾ÛŒØª Ú©Ø±Ø¯ÙˆÙˆÛ• Ù„Û• Ù†ÛÙˆØ§Ù† Ø¯ÙˆÙˆ Ùˆ Ú©Û•ÙˆØ§Ù†Û•Ú©Û• Ø¯Ø§ÛŒØ¨Ù†Û
url = "https://docs.google.com/spreadsheets/d/14KuhfN0_hg_SLtG3s4ky6Zion3fcKE8aKG4gUBK7IEU/edit?usp=sharing"

# Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨Û• Ú¯ÙˆÚ¯Úµ Ø´ÛŒØª
conn = st.connection("gsheets", type=GSheetsConnection)

# Ø®ÙˆÛÙ†Ø¯Ù†Û•ÙˆÛ•ÛŒ Ø¯Ø§ØªØ§Ú©Ø§Ù†
try:
    df = conn.read(spreadsheet=url)
except:
    df = pd.DataFrame()

st.title("ğŸ›ï¸ Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ø¦Û†Ù†Ù„Ø§ÛŒÙ†ÛŒ Ø´Û•Ù‡ÛŒØ¯Ø§Ù†ÛŒ Ù‡Û•ÚµÛ•Ø¨Ø¬Û•")

# Ù„ÛŒØ³ØªÛ•Ú©Ø§Ù† (Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Û•Ø± Ø¨Û• Ù‡Û•ÚµÛ• Ø´Øª Ù†Û•Ù†ÙˆØ³ÛØª)
cols = [
    'Ù†Ø§ÙˆÛŒ Ú†ÙˆØ§Ø±ÛŒ Ø´Û•Ù‡ÛŒØ¯', 'Ø²Ù†Ø¬ÛŒØ±Û•', 'Ø¬Û†Ø±ÛŒ Ø´Û•Ù‡ÛŒØ¯', 'Ø´ÙˆÛÙ†ÛŒ Ù†ÛŒØ´ØªÛ•Ø¬ÛØ¨ÙˆÙˆÙ† (Ú¯Û•Ú•Û•Ú©)', 'Ù†Ø§ÙˆÛŒ Ú†ÙˆØ§Ø±ÛŒ ÙˆØ§Ø±Ø³', 
    'Ø¨Ø§Ø±ÛŒ Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒ', 'Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¦Û•Ù†Ø¯Ø§Ù…Ø§Ù†ÛŒ Ø®ÛØ²Ø§Ù†', 'Ú†Û•Ù† ÙˆØ§Ø±Ø³ÛŒ Ù‡Û•ÛŒÛ•', 'Ù¾ÛŒØ´Û•ÛŒ ÙˆØ§Ø±Ø³', 
    'Ú˜Ù…Ø§Ø±Û•ÛŒ ØªÛ•Ù„Û•ÙÛ†Ù†', 'Ø³ÙˆØ¯Ù…Û•Ù†Ø¯Ø¨ÙˆÙˆÛ• Ù„Û• (Ø²Û•ÙˆÛŒ ÛŒØ§Ù† Ø®Ø§Ù†ÙˆÙˆ)', 'Ø¬Û†Ø±ÛŒ Ù…Û†ÚµÚ© (Ù…Û†ÚµÚ© ÛŒØ§Ù† Ú©Ø±Û)', 
    'Ø¨Ø§Ø±ÛŒ Ø¯Ø§Ø±Ø§ÛŒÛŒ (Ø¨Ø§Ø´ØŒ Ù†Ø§ÙˆÛ•Ù†Ø¯ØŒ Ø®Ø±Ø§Ù¾)', 'Ù†Û•Ø®Û†Ø´ÛŒ Ø¯Ø±ÛÚ˜Ø®Ø§ÛŒÛ•Ù† Ù„Û• Ø®ÛØ²Ø§Ù†Û•Ú©Û•ÛŒØ¯Ø§ Ù‡Û•ÛŒÛ• (Ø¨Û•ÚµÛ ÛŒØ§Ù† Ù†Û•Ø®ÛØ±)', 
    'Ø¦Ø§ÛŒØ§ Ø®Ø§ÙˆÛ•Ù† Ù¾ÛØ¯Ø§ÙˆÛŒØ³ØªÛŒ ØªØ§ÛŒØ¨Û•Øª Ù‡Û•ÛŒÛ• (Ø¨Û•ÚµÛ ÛŒØ§Ù† Ù†Û•Ø®ÛØ± )'
]

# --- ÙÛ†Ø±Ù…ÛŒ Ø¯Ø§Ø®ÚµÚ©Ø±Ø¯Ù† ---
with st.form("input_form", clear_on_submit=True):
    st.subheader("ğŸ“ ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù†ÙˆÛ")
    col1, col2 = st.columns(2)
    new_data = {}
    
    for i, c in enumerate(cols):
        with col1 if i % 2 == 0 else col2:
            if "Ø¬Û†Ø±ÛŒ Ø´Û•Ù‡ÛŒØ¯" in c:
                new_data[c] = st.selectbox(c, ["Ø¬ÛŒÙ†Û†Ø³Ø§ÛŒØ¯", "Ø³Û•Ù†Ú¯Û•Ø±", "Ù‡Ø§ÙˆÙˆÚµØ§ØªÛŒ"])
            elif "Ø¨Ø§Ø±ÛŒ Ú©Û†Ù…Û•ÚµØ§ÛŒÛ•ØªÛŒ" in c:
                new_data[c] = st.selectbox(c, ["Ø®ÛØ²Ø§Ù†Ø¯Ø§Ø±", "Ø³Û•ÚµØª"])
            elif "Ø¨Û•ÚµÛ ÛŒØ§Ù† Ù†Û•Ø®ÛØ±" in c:
                new_data[c] = st.selectbox(c, ["Ø¨Û•ÚµÛ", "Ù†Û•Ø®ÛØ±"])
            else:
                new_data[c] = st.text_input(c)
            
    submit = st.form_submit_button("ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù† Ù„Û• Ø¦Û†Ù†Ù„Ø§ÛŒÙ†")
    
    if submit:
        if new_data['Ù†Ø§ÙˆÛŒ Ú†ÙˆØ§Ø±ÛŒ Ø´Û•Ù‡ÛŒØ¯'] and new_data['Ø²Ù†Ø¬ÛŒØ±Û•']:
            new_row = pd.DataFrame([new_data])
            updated_df = pd.concat([df, new_row], ignore_index=True)
            conn.update(spreadsheet=url, data=updated_df)
            st.success("Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ù„Û• Ú¯ÙˆÚ¯Úµ Ø´ÛŒØª Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ú©Ø±Ø§!")
            st.rerun()
        else:
            st.warning("ØªÚ©Ø§ÛŒÛ• Ù†Ø§Ùˆ Ùˆ Ø²Ù†Ø¬ÛŒØ±Û• Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•")

# --- Ù†ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø®Ø´ØªÛ• ---
st.divider()
st.subheader("ğŸ“Š Ø²Ø§Ù†ÛŒØ§Ø±ÛŒÛŒÛ• ØªÛ†Ù…Ø§Ø±Ú©Ø±Ø§ÙˆÛ•Ú©Ø§Ù†")
if not df.empty:
    st.dataframe(df.iloc[::-1], use_container_width=True)
else:
    st.info("Ù‡ÛŒÚ† Ø¯Ø§ØªØ§ÛŒÛ•Ú© Ù„Û• Ú¯ÙˆÚ¯Úµ Ø´ÛŒØªÛ•Ú©Û•Ø¯Ø§ Ù†ÛŒÛŒÛ•.")
